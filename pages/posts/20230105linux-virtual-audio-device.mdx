import BlogLayout from '../../components/BlogLayout';
import Meta from '../../components/Meta';

export const meta = {
  title: 'ã€PulseAudio, ALSAã€‘Linuxã§ä»®æƒ³éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œã‚‹æ–¹æ³•',
  category: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°',
  categoryEn: 'programing',
  tags: ['Linux', 'PulseAudio', 'ALSA'],
  date: '2023-01-05',
  update: '2023-02-13',
  outline:
    'ALSAã‚„PulseAudioã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã€ä»®æƒ³éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ä»®æƒ³ãƒã‚·ãƒ³ãªã©ã§éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹ãŒãªã„æ™‚ã‚„ã€ãƒ‡ãƒã‚¤ã‚¹å†…ã§éŸ³å£°ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ãŸã„å ´åˆã«ä½¿ãˆã¾ã™',
  link: '/posts/20230105linux-virtual-audio-device',
  headImage: '/20230105/title.png',
};

## ALSA ã¨ PulseAudio

[ALSA](https://www.alsa-project.org/wiki/Main_Page)(Advanced Linux Sound Architecture)ã¨ã¯ã€Linux ã«ãŠã‘ã‚‹ã‚µã‚¦ãƒ³ãƒ‰ãƒ‡ãƒã‚¤ã‚¹ã®è¨­å®šãƒ»ç®¡ç†ãŒã§ãã‚‹ä»•çµ„ã¿ã€‚
ã—ã‹ã—ã€ALSA ã¯è¤‡æ•°ã‚¢ãƒ—ãƒªã‹ã‚‰ï¼‘ã¤ã®éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã€‚
ãã“ã§ã€è¤‡æ•°ã®å…¥å‡ºåŠ›ã‚’å¯èƒ½ã¨ã™ã‚‹ã®ãŒã€[PulseAudio](https://pulse.audio/)ã€‚

## ALSA ç·¨

å˜ç´”ã«ã€Œä»®æƒ³ãƒ‡ãƒã‚¤ã‚¹ãŒæ¬²ã—ã„ï¼ã€ã‚„ã€Œãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã—ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã“ã£ã¡ã§ååˆ†ã€‚

1. snd-aloop ã‚’ load

   ```bash
   $ sudo modprobe snd-aloop
   #érootãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®ã®ã‚¢ã‚¯ã‚»ã‚¹è¨­å®š
   $ sudo adduser $USER audio
   ```

2. ãƒ‡ãƒã‚¤ã‚¹ãŒè¿½åŠ ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª

   ```bash
   $ sudo apt install alsa-utils
   # PlayBack(å‡ºåŠ›)
   $ aplay -l
   **** List of PLAYBACK Hardware Devices ****
   card 0: Loopback [Loopback], device 0: Loopback PCM [Loopback PCM]
     Subdevices: 6/8
     Subdevice #0: subdevice #0
     Subdevice #1: subdevice #1
     Subdevice #2: subdevice #2
     Subdevice #3: subdevice #3
     Subdevice #4: subdevice #4
     Subdevice #5: subdevice #5
     Subdevice #6: subdevice #6
     Subdevice #7: subdevice #7
   card 0: Loopback [Loopback], device 1: Loopback PCM [Loopback PCM]
     Subdevices: 8/8
     Subdevice #0: subdevice #0
     Subdevice #1: subdevice #1
     Subdevice #2: subdevice #2
     Subdevice #3: subdevice #3
     Subdevice #4: subdevice #4
     Subdevice #5: subdevice #5
     Subdevice #6: subdevice #6
     Subdevice #7: subdevice #7

   # Record(å…¥åŠ›)
   $ arecord -l
   **** List of CAPTURE Hardware Devices ****
   card 0: Loopback [Loopback], device 0: Loopback PCM [Loopback PCM]
     Subdevices: 8/8
     Subdevice #0: subdevice #0
     Subdevice #1: subdevice #1
     Subdevice #2: subdevice #2
     Subdevice #3: subdevice #3
     Subdevice #4: subdevice #4
     Subdevice #5: subdevice #5
     Subdevice #6: subdevice #6
     Subdevice #7: subdevice #7
   card 0: Loopback [Loopback], device 1: Loopback PCM [Loopback PCM]
     Subdevices: 8/8
     Subdevice #0: subdevice #0
     Subdevice #1: subdevice #1
     Subdevice #2: subdevice #2
     Subdevice #3: subdevice #3
     Subdevice #4: subdevice #4
     Subdevice #5: subdevice #5
     Subdevice #6: subdevice #6
     Subdevice #7: subdevice #7
   ```

3. ä½¿ã£ã¦ã¿ã‚‹

   ```bash
   # é©å½“ãªWAVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦
   $ aplay -D hw:Loopback,0,0 sample.wav
   ```

- å‰Šé™¤ã—ãŸããªã£ãŸã‚‰

  ```bash
  $ sudo modprobe -r snd-aloop
  ```

- Tip: èµ·å‹•æ™‚ã«è‡ªå‹•ãƒ­ãƒ¼ãƒ‰  
   /etc/modules ã« vi ãªã©ã§è¿½è¨˜
  ```sh
  # /etc/modules: kernel modules to load at boot time.
  #
  # This file contains the names of kernel modules that should be loaded
  # at boot time, one per line. Lines beginning with "#" are ignored.
  snd-aloop <-ã“ã‚Œè¿½è¨˜
  ```

## PulseAudio ç·¨

è¤‡æ•°ã‚¢ãƒ—ãƒªã‹ã‚‰éŸ³å£°å…¥åŠ›ã‚’è¡Œã†å ´åˆã‚„ã€éŸ³å£°ã®å…¥å‡ºåŠ›ã‚’å°‘ã—è¤‡é›‘ã«ç®¡ç†ã™ã‚‹å ´åˆã¯ PulseAudio ãŒè‰¯ã„ã€‚

1. pactl(PulseAudio ã®ç®¡ç†ã‚³ãƒãƒ³ãƒ‰)ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
   ```bash
   $ sudo apt install pulseaudio-utils
   ```
2. ä»®æƒ³ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œæˆ

   ```bash
   # VirtualSink0ã®éƒ¨åˆ†ã¯å¥½ããªæ–‡å­—åˆ—ã§å¯
   $ pacmd load-module module-null-sink sink_name=VirtualSink0 sink_properties=device.description=VirtualSink0
   # ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã—ãŸããªã£ãŸã‚‰
   $ pacmd load-module module-loopback source=VirtualSink0.monitor source_dont_move=true
   ```

3. ç¢ºèª
   ```bash
   $ pactl list short sources
   1       VirtualSink0.monitor    module-null-sink.c      s16le 2ch 44100Hz       SUSPENDED
   ```

- å‰Šé™¤ã—ãŸããªã£ãŸã‚‰

  ```bash
  $ pacmd unload-module module-loopback
  $ pacmd unload-module module-null-sink
  ```

- Tip: èµ·å‹•æ™‚ã«è‡ªå‹•ãƒ­ãƒ¼ãƒ‰  
  /etc/pulse/default.pa ã«è¿½è¨˜

  ```sh
  load-module module-null-sink sink_name=VirtualSink0 sink_properties=device.description=VirtualSink0
  ```

- ãŠã‹ã—ããªã£ãŸã‚‰

  ```bash
  #PulseAudio
  $ pulseaudio --kill
  $ pulseaudio --start
  ```

## ã¾ã¨ã‚

ä»Šå›ã¯ã€Linux ã§éŸ³å£°ä»®æƒ³ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ï¼’ã¤ç´¹ä»‹ã—ã¾ã—ãŸã€‚  
ã©ã£ã¡ã‹æ‚©ã‚“ã ã‚‰ PulseAudio ã®ã»ã†ãŒå¤šåˆ†ç„¡é›£ã§ã™ ğŸµ

<Meta title={meta.title} description={meta.outline} url={meta.link}></Meta>
export default ({children}) => <BlogLayout meta={meta}>{children}</BlogLayout>
